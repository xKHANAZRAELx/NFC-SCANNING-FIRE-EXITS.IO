<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFC Tag Scanner with Status</title>
    <style>
        .area {
            padding: 10px;
            margin: 10px;
            border: 1px solid black;
            display: inline-block;
            width: 100px;
            text-align: center;
        }
        .scanned {
            background-color: green;
            color: white;
        }
        .not-scanned {
            background-color: red;
            color: white;
        }
    </style>
</head>
<body>
    <h1>NFC Tag Scanner</h1>
    <p>Scan the NFC tag of each area to update its status:</p>

    <div id="areas">
        <div class="area not-scanned" id="areaA">Area A</div>
        <div class="area not-scanned" id="areaB">Area B</div>
        <div class="area not-scanned" id="areaC">Area C</div>
    </div>

    <div id="output">Bring an NFC tag close to scan...</div>

    <script>
        const areas = ['Area A', 'Area B', 'Area C'];

        // Update the visual status of each area
        function updateAreaStatus() {
            areas.forEach(area => {
                const areaElement = document.getElementById(area.toLowerCase().replace(" ", ""));
                const status = localStorage.getItem(area);
                if (status === 'scanned') {
                    areaElement.classList.remove('not-scanned');
                    areaElement.classList.add('scanned');
                } else {
                    areaElement.classList.remove('scanned');
                    areaElement.classList.add('not-scanned');
                }
            });
        }

        // Load initial status from localStorage
        updateAreaStatus();

        // Check if Web NFC is supported in this browser
        function isWebNFCSupported() {
            return 'NDEFReader' in window;
        }

        if (isWebNFCSupported()) {
            const output = document.getElementById('output');

            async function startNFCScan() {
                try {
                    const ndef = new NDEFReader();
                    await ndef.scan();

                    ndef.onreading = (event) => {
                        // Extract NFC tag data as text
                        const record = event.message.records[0];
                        let tagText = '';

                        // Handle text-type NFC tags (most common)
                        if (record.recordType === "text") {
                            const textDecoder = new TextDecoder(record.encoding);
                            tagText = textDecoder.decode(record.data);
                        }

                        // Log the scanned tag and show it on the output
                        output.innerHTML = `Tag Scanned: ${tagText}`;

                        // Check if the scanned text matches any area
                        if (areas.includes(tagText.trim())) {
                            // Store scan status in localStorage
                            localStorage.setItem(tagText.trim(), 'scanned');
                            // Update the UI
                            updateAreaStatus();
                        } else {
                            output.innerHTML = `Unknown area scanned: ${tagText}`;
                        }
                    };
                } catch (error) {
                    output.innerHTML = `NFC scan failed: ${error.message}`;
                }
            }

            // Start scanning automatically
            window.addEventListener('load', startNFCScan);
        } else {
            const output = document.getElementById('output');
            output.innerHTML = "NFC not supported in this browser. Try using Samsung Internet or enable NFC in Chrome flags.";
        }
    </script>
</body>
</html>
